# shell 函数

编程语言一般都有函数的概念，shell 也有自己的函数。函数的作用是把一堆代码块组织成一个整体，完成具体的功能。函数的使用分两部分，先定义后调用。



## 函数定义

函数的定义有三种方式。

### 方式1：完整形式

~~~bash
function funcname () {
    # 函数体代码块
}
~~~

>注意：如果函数的定义写在一行，那 `{}` 内层要和代码块保留至少一个空格。



### 方式2：省略关键字

~~~bash
funcname(){
    # 函数体代码块
}
~~~



### 方式3：省略小括号

~~~bash
function funcname {
    # 函数体代码块
}
~~~





## 函数调用

函数的调用很简单，直接函数名即可。如果需要给函数传参数，把参数跟在函数名后面，多个参数使用空格隔开。

### 调用函数

~~~bash
#!/bin/bash
function hello(){
    echo "hello ${USER}"
}

# 调用函数
hello
~~~



### 给函数传参数

给函数传参数后，函数内使用 `${N}` 的方式取值，当然了，如果是第1个～第9个参数，可以简写为 `$N`。和 shell脚本接收参数类似，使用 `$#` 获取参数的个数，使用 `$*` 或 `$@` 接收所有参数。`$0` 是函数所在脚本的名字。需要注意：**虽然函数接收参数的方式和 shell 脚本接收参数的方式看起来近似，但它们是不独立的**。

~~~bash
#!/bin/bash
function iter_echo(){
    echo "${1}"
    echo "${2}"
    echo "$1"
    echo "---"
    for i in "$@"; do
        echo "$i"
    done
}

# 调用函数
iter_echo hello world "i am a student"
~~~



### 使用 return 结束函数

和常见编程语言的函数使用关键字 `return` 返回函数的处理结果不一样，shell 函数虽然也可以使用函数，但功能是完全不同的。在 shell 函数中 `return` 最常用的功能就是结束函数的运行，除此之外，它可以用来返回 0-255 之内的数字作为函数的运行状态，默认返回数字0。

~~~bash
#!/bin/bash
function ttt () {
    for i in `seq 1 100`; do
       echo $i;
       if (( i > 3 )); then
           return 100
       fi
    done
}

# 调用函数
ttt
echo $?
~~~



### 获取函数的处理结果

想要把函数的处理结果赋值给一个变量使用，最简单的方法就是使用 `echo`。

~~~bash
#!/bin/bash
function add_two_num(){
    z=$(( $1 + $2 ))
    echo $z
}

# 获取函数的计算结果
result=$(add_two_num 100 23)
echo $result
~~~

**注意：如果函数内echo多次，那么拿到的result就是多条echo的文本了**





## 变量作用域

变量的作用域有：局部作用域、全局作用域、环境变量。

### 局部作用域

函数内定义的变量如果想要个函数外的变量完全隔开，可以使用 `local` 声明。被 `local` 声明的函数只能在函数内使用，函数外看不到。

~~~bash
function test(){
  local x
  x=10
  echo $x
}

test
echo $x	# 用不到
~~~



### 全局作用域

全局作用域之的就是在 bash 进程内都可以使用的。比如使用 `source` 把一个脚本文件加载到当前 bash，那么这个脚本中定义的变量（无论是函数内未使用 `local` 定义的变量还是函数外定义的变量）都会被当加载到当前 bash 成为全局作用域的变量。

**函数内的局部变量如果和当前bash中的全局变量同名，函数内优先使用局部变量。**



### 环境作用域（环境变量）

使用 `export` 定义的变量，可以在任意子bash 中使用。注意：只能父传子、不能倒着来；export 定义的变量都是临时的。如果想要实现持久话，结合进入 shell 环境必须加载的那些脚本文件，将 export xxx=1 放到这些脚本文件中。